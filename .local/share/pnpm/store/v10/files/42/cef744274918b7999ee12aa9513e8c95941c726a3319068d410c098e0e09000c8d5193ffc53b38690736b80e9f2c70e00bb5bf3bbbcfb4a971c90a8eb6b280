"use strict";
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/index.ts
var src_exports = {};
__export(src_exports, {
  EffectTest: () => EffectTest,
  FAKE_TOKEN_MINT: () => FAKE_TOKEN_MINT,
  GambaCanvas: () => GambaCanvas,
  GambaPlatformContext: () => GambaPlatformContext,
  GambaPlatformProvider: () => GambaPlatformProvider,
  GambaStandardTokens: () => GambaStandardTokens,
  GambaUi: () => GambaUi,
  GameContext: () => GameContext,
  PlayButton: () => PlayButton,
  TokenMetaContext: () => TokenMetaContext,
  TokenMetaProvider: () => TokenMetaProvider,
  TokenValue: () => TokenValue,
  makeHeliusTokenFetcher: () => makeHeliusTokenFetcher,
  useCurrentPool: () => useCurrentPool,
  useCurrentToken: () => useCurrentToken,
  useFakeAccountStore: () => useFakeAccountStore,
  useFakeToken: () => useFakeToken,
  useFees: () => useFees,
  useGambaAudioStore: () => useGambaAudioStore,
  useGambaPlatformContext: () => useGambaPlatformContext,
  useGame: () => useGame,
  useNextFakeResult: () => useNextFakeResult,
  useSound: () => useSound,
  useSoundStore: () => useSoundStore,
  useTokenBalance: () => useTokenBalance,
  useTokenList: () => useTokenList,
  useTokenMeta: () => useTokenMeta,
  useUserBalance: () => useUserBalance,
  useWagerInput: () => useWagerInput
});
module.exports = __toCommonJS(src_exports);
var import_web36 = require("@solana/web3.js");
var import_react24 = __toESM(require("react"));

// src/GambaPlatformProvider.tsx
var import_web3 = require("@solana/web3.js");
var import_gamba_core_v2 = require("gamba-core-v2");
var import_react2 = __toESM(require("react"));

// src/PortalContext.tsx
var import_react = __toESM(require("react"));
var import_react_dom = __toESM(require("react-dom"));
var PortalContext = import_react.default.createContext(null);
var PortalProvider = (props) => {
  const [refs, _setRefs] = import_react.default.useState({});
  const context = {
    refs,
    setRef(target, ref) {
      _setRefs((refs2) => ({ ...refs2, [target]: ref }));
    }
  };
  return /* @__PURE__ */ import_react.default.createElement(PortalContext.Provider, { value: context }, props.children);
};
function Portal(props) {
  const { refs } = import_react.default.useContext(PortalContext);
  return /* @__PURE__ */ import_react.default.createElement(import_react.default.Fragment, null, refs[props.target]?.current && import_react_dom.default.createPortal(props.children, refs[props.target]?.current));
}
function PortalTarget(props) {
  const { setRef } = import_react.default.useContext(PortalContext);
  const ref = import_react.default.useRef(null);
  import_react.default.useEffect(
    () => {
      setRef(props.target, ref);
      return () => setRef(props.target, null);
    },
    [props.target]
  );
  return /* @__PURE__ */ import_react.default.createElement("div", { style: { display: "contents" }, ref }, props.children);
}

// src/GambaPlatformProvider.tsx
var GambaPlatformContext = import_react2.default.createContext(null);
function GambaPlatformProvider(props) {
  const { creator, children } = props;
  const [selectedPool, setSelectedPool] = import_react2.default.useState(props.defaultPool ?? { token: import_gamba_core_v2.NATIVE_MINT });
  const [clientSeed, setClientSeed] = import_react2.default.useState(String(Math.random() * 1e9 | 0));
  const [defaultJackpotFee, setDefaultJackpotFee] = import_react2.default.useState(props.defaultJackpotFee ?? 1e-3);
  const defaultCreatorFee = props.defaultCreatorFee ?? 0.01;
  const setPool = (tokenMint, authority = new import_web3.PublicKey("11111111111111111111111111111111")) => {
    setSelectedPool({
      token: new import_web3.PublicKey(tokenMint),
      authority: new import_web3.PublicKey(authority)
    });
  };
  const setToken = (tokenMint) => {
    setPool(tokenMint);
  };
  return /* @__PURE__ */ import_react2.default.createElement(
    GambaPlatformContext.Provider,
    {
      value: {
        platform: {
          name: "",
          creator: new import_web3.PublicKey(creator)
        },
        selectedPool,
        setToken,
        setPool,
        clientSeed,
        setClientSeed,
        defaultJackpotFee,
        setDefaultJackpotFee,
        defaultCreatorFee
      }
    },
    /* @__PURE__ */ import_react2.default.createElement(PortalProvider, null, children)
  );
}

// src/TokenMetaProvider.tsx
var import_react3 = __toESM(require("react"));
var import_web32 = require("@solana/web3.js");
var FAKE_TOKEN_MINT = new import_web32.PublicKey("FakeCDoCX1NWywV9m63fk7gmV9S4seMoyqzcNYEmRYjy");
var TokenMetaContext = import_react3.default.createContext({});
function TokenMetaProvider({ children, tokens = [], fetcher, debounce }) {
  const byMint = import_react3.default.useMemo(
    () => {
      return tokens.reduce((prev, value) => ({
        ...prev,
        [value.mint.toString()]: value
      }), {});
    },
    [tokens]
  );
  const fallback = (mint) => {
    return byMint[mint.toString()];
  };
  return /* @__PURE__ */ import_react3.default.createElement(TokenMetaContext.Provider, { value: { tokens, fallback, fetcher, debounce } }, children);
}

// src/hooks/index.ts
var import_gamba_react_v27 = require("gamba-react-v2");
var import_react23 = __toESM(require("react"));

// src/hooks/useCurrentPool.ts
var import_gamba_react_v22 = require("gamba-react-v2");
var import_react5 = require("react");

// src/hooks/useFakeToken.ts
var import_gamba_react_v2 = require("gamba-react-v2");
var import_react4 = __toESM(require("react"));
var import_zustand = require("zustand");
var import_gamba_core_v22 = require("gamba-core-v2");
var betBuffer;
var useFakeAccountStore = (0, import_zustand.create)(
  (set) => ({
    balance: 1e12,
    set
  })
);
useNextFakeResult.delay = 500;
function useNextFakeResult() {
  const store = useFakeAccountStore();
  const context = import_react4.default.useContext(GambaPlatformContext);
  const user = (0, import_gamba_react_v2.useWalletAddress)();
  return async function getNextFakeResult() {
    if (!betBuffer)
      throw new Error("No game in progress");
    await new Promise((resolve) => setTimeout(resolve, useNextFakeResult.delay));
    const resultIndex = Math.random() * betBuffer.bet.length | 0;
    const multiplier = betBuffer.bet[resultIndex];
    const wager = betBuffer.wager;
    const payout = multiplier * wager;
    const profit = payout - wager;
    store.set(
      (state) => ({ balance: state.balance + payout })
    );
    return {
      creator: context.platform.creator,
      user,
      rngSeed: "fake_rng_seed",
      clientSeed: betBuffer.clientSeed ?? "",
      nonce: 0,
      bet: betBuffer.bet,
      resultIndex,
      wager,
      payout,
      profit,
      multiplier,
      token: context.selectedPool.token,
      bonusUsed: 0,
      jackpotWin: 0
    };
  };
}
function useFakeToken() {
  const context = import_react4.default.useContext(GambaPlatformContext);
  const balance = useFakeAccountStore();
  const result = useNextFakeResult();
  const isActive = context.selectedPool.token.equals(FAKE_TOKEN_MINT);
  const play = (input) => {
    if (balance.balance < input.wager) {
      throw (0, import_gamba_react_v2.throwTransactionError)(new Error("Insufficient funds"));
    }
    balance.set(({ balance: balance2 }) => ({ balance: balance2 - input.wager }));
    betBuffer = input;
    return "fake_game";
  };
  const pool = {
    publicKey: (0, import_gamba_core_v22.getPoolAddress)(context.selectedPool.token),
    authority: import_gamba_core_v22.SYSTEM_PROGRAM,
    token: context.selectedPool.token,
    minWager: 0,
    gambaFee: 0,
    poolFee: 0,
    jackpotBalance: 0,
    liquidity: BigInt(1e99),
    maxPayout: 1e99
  };
  return { isActive, balance, result, play, pool };
}

// src/hooks/useCurrentPool.ts
var useCurrentPool = () => {
  const { selectedPool } = (0, import_react5.useContext)(GambaPlatformContext);
  const pool = (0, import_gamba_react_v22.usePool)(selectedPool.token, selectedPool.authority);
  const fake = useFakeToken();
  if (fake.isActive) {
    return fake.pool;
  }
  return pool;
};

// src/hooks/useTokenMeta.tsx
var import_signals_react = require("@preact/signals-react");
var import_web33 = require("@solana/web3.js");
var import_react6 = __toESM(require("react"));
var DEFAULT_DEBOUNCE_MS = 0;
var tokenMints = (0, import_signals_react.signal)(/* @__PURE__ */ new Set());
var tokenData = (0, import_signals_react.signal)({});
var STANDARD_TOKEN_DATA = {
  So11111111111111111111111111111111111111112: {
    name: "Solana",
    symbol: "SOL",
    decimals: 9,
    image: "https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png",
    baseWager: 0.05 * 1e9
  },
  EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v: {
    symbol: "USDC",
    image: "https://raw.githubusercontent.com/solana-labs/token-list/main/assets/mainnet/EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v/logo.png",
    usdPrice: 1,
    decimals: 6,
    baseWager: 1 * 1e6
  },
  [FAKE_TOKEN_MINT.toString()]: {
    name: "Fake Money",
    symbol: "FAKE",
    decimals: 9,
    baseWager: 1 * 1e9,
    usdPrice: 0
  }
};
var fetchTimeout;
function useTokenMeta(mint) {
  const context = import_react6.default.useContext(TokenMetaContext);
  const fetchedTokenData = tokenData.value[mint.toString()];
  import_react6.default.useEffect(() => {
    tokenMints.value.add(mint.toString());
    clearTimeout(fetchTimeout);
    fetchTimeout = setTimeout(async () => {
      if (!context.fetcher)
        return;
      const unique = Array.from(tokenMints.value).filter((x) => x !== FAKE_TOKEN_MINT.toString() && !Object.keys(tokenData.value).includes(x));
      if (!unique.length) {
        return;
      }
      console.debug("Fetching Mint", unique);
      const newData = await context.fetcher(unique);
      tokenData.value = { ...tokenData.value, ...newData };
      tokenMints.value.clear();
    }, context.debounce ?? DEFAULT_DEBOUNCE_MS);
    return () => {
      clearTimeout(fetchTimeout);
    };
  }, [mint.toString()]);
  const defaultToken = {
    mint: new import_web33.PublicKey(mint),
    name: "Unknown",
    symbol: mint.toString().substring(0, 3),
    image: void 0,
    decimals: 9,
    baseWager: 1,
    usdPrice: 0
  };
  const fallback = context.fallback ?? (() => void 0);
  return {
    ...defaultToken,
    ...fetchedTokenData,
    ...STANDARD_TOKEN_DATA[mint.toString()],
    ...fallback(mint)
  };
}
useTokenMeta.debouce = DEFAULT_DEBOUNCE_MS;
useTokenMeta.fallback = (mint) => {
  return void 0;
};
useTokenMeta.setFallbackHandler = (cb) => {
};
useTokenMeta.fetcher = (mints) => {
  return {};
};
useTokenMeta.setFetcher = (cb) => {
};

// src/hooks/useGame.ts
var import_web34 = require("@solana/web3.js");
var import_gamba_react_v26 = require("gamba-react-v2");
var import_react22 = __toESM(require("react"));

// src/GameContext.tsx
var import_gamba_react_v25 = require("gamba-react-v2");
var import_react21 = __toESM(require("react"));

// src/EffectTest.tsx
var import_react8 = __toESM(require("react"));

// src/hooks/useAnimationFrame.ts
var import_react7 = require("react");
var useAnimationFrame_default = (cb) => {
  if (typeof performance === "undefined" || typeof window === "undefined") {
    return;
  }
  const cbRef = (0, import_react7.useRef)(null);
  const frame = (0, import_react7.useRef)();
  const init = (0, import_react7.useRef)(performance.now());
  const last = (0, import_react7.useRef)(performance.now());
  cbRef.current = cb;
  const animate = (now) => {
    cbRef.current({
      time: (now - init.current) / 1e3,
      delta: (now - last.current) / 1e3
    });
    last.current = now;
    frame.current = requestAnimationFrame(animate);
  };
  (0, import_react7.useLayoutEffect)(() => {
    frame.current = requestAnimationFrame(animate);
    return () => {
      frame.current && cancelAnimationFrame(frame.current);
    };
  }, []);
};

// src/EffectTest.tsx
function EffectTest({ src }) {
  const parts = import_react8.default.useRef(Array.from({ length: 25 }).map(() => ({
    x: Math.random(),
    y: -Math.random() * 600
  })));
  const image = import_react8.default.useMemo(
    () => {
      const image2 = document.createElement("img");
      image2.src = src;
      return image2;
    },
    [src]
  );
  useAnimationFrame_default(
    () => {
      parts.current.forEach(
        (part, i) => {
          const speed = (1 + Math.sin(i * 44213.3) * 0.1) * 5;
          part.y += speed;
        }
      );
    }
  );
  return /* @__PURE__ */ import_react8.default.createElement(
    GambaUi.Canvas,
    {
      zIndex: 99,
      style: { pointerEvents: "none" },
      render: ({ ctx, size }, clock) => {
        ctx.save();
        ctx.clearRect(0, 0, size.width, size.height);
        ctx.fillStyle = "#00000011";
        ctx.fillRect(0, 0, size.width, size.height);
        ctx.font = "30px arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillStyle = "#22ff11";
        parts.current.forEach(
          (part, i) => {
            ctx.save();
            ctx.translate(part.x * size.width, size.height - part.y - 25);
            ctx.scale(0.5, 0.5);
            ctx.drawImage(image, 0, 0);
            ctx.restore();
          }
        );
        ctx.restore();
      }
    }
  );
}

// src/ErrorBoundary.tsx
var import_react9 = __toESM(require("react"));
var ErrorBoundary = class extends import_react9.default.Component {
  state = { hasError: false, error: null };
  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }
  componentDidCatch(error, errorInfo) {
    this.props.onError && this.props.onError(error);
    this.setState({ hasError: true, error: errorInfo });
  }
  render() {
    if (this.state.hasError) {
      if (this.props.fallback)
        return this.props.fallback;
      return null;
    }
    return this.props.children;
  }
};

// src/components/Button.tsx
var import_react10 = __toESM(require("react"));
var import_styled_components = __toESM(require("styled-components"));
var StyledButton = import_styled_components.default.button`
  --color: var(--gamba-ui-button-default-color);
  --background-color: var(--gamba-ui-button-default-background);
  --background-color-hover: var(--gamba-ui-button-default-background-hover);

  ${(props) => props.$main && import_styled_components.css`
    --background-color: var(--gamba-ui-button-main-background);
    --color: var(--gamba-ui-button-main-color);
    --background-color-hover: var(--gamba-ui-button-main-background-hover);
  `}

  ${(props) => import_styled_components.css`
    --padding: ${props.$size === "small" ? "5px" : props.$size === "medium" ? "10px" : props.$size === "large" && "15px"};
  `}

  background: var(--background-color);
  color: var(--color);
  &:hover {
    background: var(--background-color-hover);
  }

  border: none;
  border-radius: var(--gamba-ui-border-radius);
  padding: var(--padding);
  cursor: pointer;
  /* min-width: 100px; */
  text-align: center;
  align-items: center;

  &:disabled {
    cursor: default;
    opacity: .7;
  }
`;
function Button(props) {
  return /* @__PURE__ */ import_react10.default.createElement(
    StyledButton,
    {
      disabled: props.disabled,
      onClick: props.onClick,
      $main: props.main,
      $size: props.size ?? "medium"
    },
    props.children
  );
}

// src/components/Canvas.tsx
var import_react11 = __toESM(require("react"));
var GambaCanvas = import_react11.default.forwardRef(function Canvas(props, forwardRef) {
  const { render, zIndex = 0, style, ...rest } = props;
  const wrapper = import_react11.default.useRef(null);
  const canvas = import_react11.default.useRef(null);
  import_react11.default.useImperativeHandle(forwardRef, () => canvas.current);
  useAnimationFrame_default(
    (time) => {
      const ctx = canvas.current.getContext("2d");
      ctx.save();
      ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
      render(
        {
          canvas: canvas.current,
          ctx,
          size: {
            width: wrapper.current.clientWidth,
            height: wrapper.current.clientHeight
          }
        },
        time
      );
      ctx.restore();
    }
  );
  import_react11.default.useLayoutEffect(() => {
    let timeout;
    const resize = () => {
      canvas.current.width = wrapper.current.clientWidth * window.devicePixelRatio;
      canvas.current.height = wrapper.current.clientHeight * window.devicePixelRatio;
    };
    const ro = new ResizeObserver(resize);
    ro.observe(wrapper.current);
    const resizeHandler = () => {
      clearTimeout(timeout);
      timeout = setTimeout(() => {
        resize();
      }, 250);
    };
    window.addEventListener("resize", resizeHandler);
    return () => {
      window.removeEventListener("resize", resizeHandler);
      ro.disconnect();
      clearTimeout(timeout);
    };
  }, []);
  return /* @__PURE__ */ import_react11.default.createElement("div", { ref: wrapper, style: { position: "absolute", left: 0, top: 0, width: "100%", height: "100%", zIndex } }, /* @__PURE__ */ import_react11.default.createElement("canvas", { ...rest, style: { width: "100%", height: "100%", ...style }, ref: canvas }));
});

// src/components/ResponsiveSize.tsx
var import_react12 = __toESM(require("react"));
var import_styled_components2 = __toESM(require("styled-components"));
var Responsive = import_styled_components2.default.div`
  justify-content: center;
  align-items: center;
  display: flex;
  width: 100%;
  flex-direction: column;
  max-width: 100vw;
  height: 100%;
  left: 0;
  top: 0;
`;
function ResponsiveSize({ children, maxScale = 1, overlay, ...props }) {
  const wrapper = import_react12.default.useRef(null);
  const inner = import_react12.default.useRef(null);
  const content = import_react12.default.useRef(null);
  import_react12.default.useLayoutEffect(() => {
    let timeout;
    const resize = () => {
      const ww = wrapper.current.clientWidth / (content.current.scrollWidth + 40);
      const hh = wrapper.current.clientHeight / (content.current.clientHeight + 80);
      const zoom = Math.min(maxScale, ww, hh);
      inner.current.style.transform = "scale(" + zoom + ")";
    };
    const ro = new ResizeObserver(resize);
    ro.observe(wrapper.current);
    const resizeHandler = () => {
      clearTimeout(timeout);
      timeout = setTimeout(() => {
        resize();
      }, 250);
    };
    window.addEventListener("resize", resizeHandler);
    return () => {
      window.removeEventListener("resize", resizeHandler);
      ro.disconnect();
      clearTimeout(timeout);
    };
  }, [maxScale]);
  return /* @__PURE__ */ import_react12.default.createElement(Responsive, { ...props, ref: wrapper }, /* @__PURE__ */ import_react12.default.createElement("div", { ref: inner }, /* @__PURE__ */ import_react12.default.createElement("div", { ref: content }, children)));
}

// src/components/Select.tsx
var import_react13 = __toESM(require("react"));
var import_styled_components3 = __toESM(require("styled-components"));
var StyledWrapper = import_styled_components3.default.div`
  position: relative;
`;
var StyledPopup = import_styled_components3.default.div`
  position: absolute;
  bottom: 100%;
  left: 0;
  width: max-content;
  display: flex;
  flex-direction: column;
  gap: 5px;
  border-radius: 10px;
  padding: 5px;
  color: var(--gamba-ui-input-color);
  background: var(--gamba-ui-input-background);
  white-space: nowrap;
  transform: translateY(-5px);
  z-index: 100;
  & > button {
    all: unset;
    box-sizing: border-box;
    cursor: pointer;
    font-size: inherit;
    padding: 5px;
    display: flex;
    align-items: center;
    &:hover {
      background: var(--gamba-ui-input-background-hover);
    }
  }
`;
function Select(props) {
  const [open, setOpen] = import_react13.default.useState(false);
  const set = (val) => {
    setOpen(false);
    props.onChange(val);
  };
  return /* @__PURE__ */ import_react13.default.createElement(StyledWrapper, { className: props.className }, /* @__PURE__ */ import_react13.default.createElement(Button, { disabled: props.disabled, onClick: () => setOpen(!open) }, props.label ? props.label(props.value) : JSON.stringify(props.value)), open && /* @__PURE__ */ import_react13.default.createElement(StyledPopup, null, props.options.map((val, i) => /* @__PURE__ */ import_react13.default.createElement("button", { key: i, onClick: () => set(val) }, props.label ? props.label(val) : JSON.stringify(val)))));
}

// src/components/Switch.tsx
var import_react14 = __toESM(require("react"));
var import_styled_components4 = __toESM(require("styled-components"));
var SwitchButton = import_styled_components4.default.input`
  all: unset;
  cursor: pointer;
  position: relative;
  height: 25px;
  aspect-ratio: 2 / 1;
  border-radius: 20px;
  background: #0e0e16;
  &:checked:after {
    left: 50%;
  }
  &:after {
    transition: left .1s ease;
    content: " ";
    height: 100%;
    width: 50%;
    left: 0;
    top: 0;
    border-radius: 20px;
    position: absolute;
    background: #9564ff;
  }
  &:not(:disabled):hover {
    outline: #9564ff solid 1px;
    outline-offset: 1px;
  }
  &:disabled {
    &:after {
      background: gray;
    }
  }
`;
function Switch(props) {
  return /* @__PURE__ */ import_react14.default.createElement(
    SwitchButton,
    {
      type: "checkbox",
      className: props.className,
      checked: props.checked,
      disabled: props.disabled,
      onChange: (evt) => props.onChange && props.onChange(evt.target.checked)
    }
  );
}

// src/components/TextInput.tsx
var import_react15 = __toESM(require("react"));
var import_styled_components5 = __toESM(require("styled-components"));
var StyledTextInput = import_styled_components5.default.input`
  color: var(--gamba-ui-input-color);
  background: var(--gamba-ui-input-background);
  &:hover {
    background: var(--gamba-ui-input-background-hover);
  }

  border: none;
  border-radius: 10px;
  padding: 10px;
  cursor: pointer;
  min-width: 100px;
  align-items: center;

  &:disabled {
    cursor: default;
    opacity: .7;
  }
`;
function TextInput({ onChange, ...props }) {
  return /* @__PURE__ */ import_react15.default.createElement(
    StyledTextInput,
    {
      type: "text",
      onChange: (evt) => onChange && onChange(evt.target.value),
      onFocus: (evt) => evt.target.select(),
      ...props
    }
  );
}

// src/components/WagerInput.tsx
var import_gamba_react_v23 = require("gamba-react-v2");
var import_react18 = __toESM(require("react"));
var import_styled_components6 = __toESM(require("styled-components"));

// src/components/TokenValue.tsx
var import_react16 = __toESM(require("react"));
function TokenValue(props) {
  const context = import_react16.default.useContext(GambaPlatformContext);
  const mint = props.mint ?? context?.selectedPool.token;
  if (!mint) {
    throw new Error('"mint" prop is required when not using GambaPlatformProvider');
  }
  const token = useTokenMeta(mint);
  const suffix = props.suffix ?? token?.symbol ?? "?";
  const tokenAmount = props.amount / 10 ** token.decimals;
  const displayedAmount = (() => {
    if (!props.exact) {
      if (tokenAmount >= 1e9) {
        return (tokenAmount / 1e9).toLocaleString(void 0, { maximumFractionDigits: 1 }) + "B";
      }
      if (tokenAmount >= 1e6) {
        return (tokenAmount / 1e6).toLocaleString(void 0, { maximumFractionDigits: 1 }) + "M";
      }
      if (tokenAmount > 1e3) {
        return (tokenAmount / 1e3).toLocaleString(void 0, { maximumFractionDigits: 1 }) + "K";
      }
    }
    return tokenAmount.toLocaleString(void 0, { maximumFractionDigits: Math.floor(tokenAmount) > 100 ? 1 : 4 });
  })();
  return /* @__PURE__ */ import_react16.default.createElement(import_react16.default.Fragment, null, displayedAmount, " ", suffix);
}

// src/hooks/useOnClickOutside.ts
var import_react17 = __toESM(require("react"));
function useOnClickOutside(ref, handler) {
  import_react17.default.useEffect(() => {
    const listener = (event) => {
      if (!ref.current || ref.current.contains(event.target)) {
        return;
      }
      handler(event);
    };
    document.addEventListener("mousedown", listener);
    document.addEventListener("touchstart", listener);
    return () => {
      document.removeEventListener("mousedown", listener);
      document.removeEventListener("touchstart", listener);
    };
  }, [ref, handler]);
}

// src/components/WagerInput.tsx
var StyledWagerInput = import_styled_components6.default.div`
  display: flex;
  justify-content: space-between;
  color: var(--gamba-ui-input-color);
  background: var(--gamba-ui-input-background);
  position: relative;
  border-radius: 10px;
  overflow: hidden;
  ${(props) => props.$edit && import_styled_components6.css`
    outline: #9564ff solid 1px;
    outline-offset: 1px;
  `}
`;
var Flex = import_styled_components6.default.button`
  all: unset;
  cursor: pointer;
  display: flex;
  align-items: center;
  flex-grow: 1;
  box-sizing: border-box;
`;
var Input = import_styled_components6.default.input`
  border: none;
  border-radius: 0;
  margin: 0;
  padding: 10px;
  padding-left: 0;
  padding-right: 0;
  color: var(--gamba-ui-input-color);
  background: var(--gamba-ui-input-background);
  outline: none;
  flex-grow: 1;

  &::-webkit-outer-spin-button,
  &::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  /* Firefox */
  &[type=number] {
    -moz-appearance: textfield;
  }
`;
var InputButton = import_styled_components6.default.button`
  border: none;
  border-radius: 0;
  margin: 0;
  padding: 2px 10px;
  color: var(--gamba-ui-input-color);
  background: var(--gamba-ui-input-background);
  cursor: pointer;
`;
var Buttons = import_styled_components6.default.div`
  display: flex;
`;
var TokenImage = import_styled_components6.default.img`
  width: 25px;
  height: 25px;
  margin: 0 5px;
  border-radius: 50%;
  -webkit-user-drag: none;
`;
var WagerAmount = import_styled_components6.default.div`
  text-wrap: nowrap;
  padding: 10px 0;
  width: 40px;

  @media (min-width: 600px) {
    width: 100px;
  }

  opacity: .8;
  overflow: hidden;
`;
function WagerInput(props) {
  const gamba = (0, import_gamba_react_v23.useGamba)();
  const token = useCurrentToken();
  const [input, setInput] = import_react18.default.useState("");
  const balance = useUserBalance();
  const fees = useFees();
  const [isEditing, setIsEditing] = import_react18.default.useState(false);
  const ref = (0, import_react18.useRef)(null);
  import_react18.default.useEffect(
    () => {
      props.onChange(token.baseWager);
    },
    [token.mint.toString()]
  );
  const startEditInput = () => {
    if (props.options) {
      setIsEditing(!isEditing);
      return;
    }
    setIsEditing(true);
    setInput(String(props.value / 10 ** token.decimals));
  };
  const apply = () => {
    props.onChange(Number(input) * 10 ** token.decimals);
    setIsEditing(false);
  };
  const x2 = () => {
    const availableBalance = balance.balance + balance.bonusBalance;
    const nextValue = Math.max(token.baseWager, props.value * 2 || token.baseWager);
    props.onChange(Math.max(0, Math.min(nextValue, availableBalance - nextValue * fees)));
  };
  useOnClickOutside(ref, () => setIsEditing(false));
  return /* @__PURE__ */ import_react18.default.createElement("div", { ref, className: props.className, style: { position: "relative" } }, /* @__PURE__ */ import_react18.default.createElement(StyledWagerInput, { $edit: isEditing }, /* @__PURE__ */ import_react18.default.createElement(Flex, { onClick: () => !gamba.isPlaying && startEditInput() }, /* @__PURE__ */ import_react18.default.createElement(TokenImage, { src: token.image }), !isEditing || props.options ? /* @__PURE__ */ import_react18.default.createElement(
    WagerAmount,
    {
      title: (props.value / 10 ** token.decimals).toLocaleString()
    },
    /* @__PURE__ */ import_react18.default.createElement(TokenValue, { suffix: "", amount: props.value, mint: token.mint })
  ) : /* @__PURE__ */ import_react18.default.createElement(
    Input,
    {
      value: input,
      type: "number",
      max: balance.balance / 10 ** token.decimals,
      min: 0,
      step: 0.05,
      style: { width: "100px" },
      onChange: (evt) => setInput(evt.target.value),
      onKeyDown: (e) => e.code === "Enter" && apply(),
      onBlur: (evt) => apply(),
      disabled: gamba.isPlaying,
      autoFocus: true,
      onFocus: (e) => e.target.select()
    }
  )), !props.options && /* @__PURE__ */ import_react18.default.createElement(Buttons, null, /* @__PURE__ */ import_react18.default.createElement(InputButton, { disabled: gamba.isPlaying, onClick: () => props.onChange(props.value / 2) }, "x.5"), /* @__PURE__ */ import_react18.default.createElement(InputButton, { disabled: gamba.isPlaying, onClick: x2 }, "2x"))), props.options && isEditing && /* @__PURE__ */ import_react18.default.createElement(StyledPopup, null, props.options.map((valueInBaseWager, i) => /* @__PURE__ */ import_react18.default.createElement(
    "button",
    {
      key: i,
      onClick: () => {
        props.onChange(valueInBaseWager * token.baseWager);
        setIsEditing(false);
      }
    },
    /* @__PURE__ */ import_react18.default.createElement(TokenImage, { src: token.image }),
    /* @__PURE__ */ import_react18.default.createElement(TokenValue, { amount: valueInBaseWager * token.baseWager, mint: token.mint })
  ))));
}

// src/components/WagerSelect.tsx
var import_gamba_react_v24 = require("gamba-react-v2");
var import_react19 = __toESM(require("react"));
function WagerSelect(props) {
  const gamba = (0, import_gamba_react_v24.useGamba)();
  return /* @__PURE__ */ import_react19.default.createElement(
    Select,
    {
      className: props.className,
      options: props.options,
      value: props.value,
      onChange: props.onChange,
      disabled: gamba.isPlaying,
      label: (value) => /* @__PURE__ */ import_react19.default.createElement(TokenValue, { amount: value })
    }
  );
}

// src/hooks/useSound.ts
var import_react20 = require("react");
var import_tone = require("tone");
var import_zustand2 = require("zustand");
var useSoundStore = (0, import_zustand2.create)(
  (set, get) => ({
    volume: 0.5,
    masterGain: 0.5,
    set: (volume) => set({ volume, masterGain: volume }),
    get
  })
);
var useGambaAudioStore = useSoundStore;
var Sound = class {
  player = new import_tone.Player();
  gain = new import_tone.Gain();
  ready = false;
  url;
  constructor(url, autoPlay = false) {
    this.url = url;
    this.player.load(url).then((x) => {
      this.ready = x.loaded;
      this.player.connect(this.gain);
      this.gain.toDestination();
      if (autoPlay) {
        this.player.loop = true;
        this.player.start();
      }
    }).catch((err) => console.error("Failed to load audio", err));
  }
  play({ playbackRate = 1, gain = 0.1 } = {}) {
    try {
      this.player.playbackRate = playbackRate;
      this.gain.set({ gain });
      this.player.start();
    } catch (err) {
      console.warn("Failed to play sound", this.url, err);
    }
  }
};
function useSound(definition) {
  const store = useSoundStore();
  const sources = Object.keys(definition);
  const soundById = (0, import_react20.useMemo)(
    () => Object.entries(definition).map(([id, url]) => {
      const sound = new Sound(url);
      return { id, sound };
    }).reduce((prev, { id, sound }) => ({
      ...prev,
      [id]: sound
    }), {}),
    [...sources]
  );
  const sounds = (0, import_react20.useMemo)(() => Object.entries(soundById).map(([_, s]) => s), [soundById]);
  (0, import_react20.useEffect)(
    () => {
      return () => {
        sounds.forEach((sound) => {
          sound.player.stop();
          sound.player.dispose();
        });
      };
    },
    [soundById]
  );
  (0, import_react20.useEffect)(
    () => {
      sounds.forEach((sound) => {
        sound.gain.set({ gain: store.volume });
      });
    },
    [store.volume]
  );
  const play = (0, import_react20.useCallback)(
    (soundId, params) => {
      const gain = params?.gain ?? 1;
      const opts = { ...params, gain: gain * store.get().volume };
      soundById[soundId].play(opts);
    },
    [soundById]
  );
  return {
    play,
    sounds: soundById
  };
}

// src/GameContext.tsx
var GameContext = import_react21.default.createContext(null);
function Game({ game, children, errorFallback }) {
  return /* @__PURE__ */ import_react21.default.createElement(GameContext.Provider, { key: game.id, value: { game } }, /* @__PURE__ */ import_react21.default.createElement(ErrorBoundary, { fallback: errorFallback }, /* @__PURE__ */ import_react21.default.createElement(import_react21.default.Suspense, { fallback: /* @__PURE__ */ import_react21.default.createElement(import_react21.default.Fragment, null) }, /* @__PURE__ */ import_react21.default.createElement(game.app, { ...game.props }))), children);
}
function PlayButton(props) {
  const gamba = (0, import_gamba_react_v25.useGamba)();
  return /* @__PURE__ */ import_react21.default.createElement(Portal, { target: "play" }, /* @__PURE__ */ import_react21.default.createElement(
    Button,
    {
      disabled: gamba.isPlaying || props.disabled,
      onClick: props.onClick,
      main: true
    },
    props.children
  ));
}
var GambaUi = {
  useGame,
  useSound,
  Portal,
  PortalTarget,
  Effect: EffectTest,
  Button,
  Game,
  Responsive: ResponsiveSize,
  Canvas: GambaCanvas,
  WagerInput,
  WagerSelect,
  Switch,
  PlayButton,
  Select,
  TextInput
};

// src/hooks/useGame.ts
function useGame() {
  const game = import_react22.default.useContext(GameContext);
  const fake = useFakeToken();
  const context = import_react22.default.useContext(GambaPlatformContext);
  const balances = useUserBalance();
  const getNextResult = (0, import_gamba_react_v26.useNextResult)();
  const gambaPlay = (0, import_gamba_react_v26.useGambaPlay)();
  const result = async () => {
    if (fake.isActive) {
      return fake.result();
    }
    return getNextResult();
  };
  const play = async (input, instructions = []) => {
    const metaArgs = input.metadata ?? [];
    const metadata = ["0", game.game.id, ...metaArgs];
    const gameInput = {
      ...input,
      creator: new import_web34.PublicKey(context.platform.creator),
      metadata,
      clientSeed: context.clientSeed,
      creatorFee: context.defaultCreatorFee,
      jackpotFee: context.defaultJackpotFee,
      token: context.selectedPool.token,
      // ,getPoolAddress(context.selectedPool.token, ),
      poolAuthority: context.selectedPool.authority,
      useBonus: balances.bonusBalance > 0
    };
    if (fake.isActive) {
      return fake.play(gameInput);
    }
    return gambaPlay(gameInput, instructions);
  };
  return {
    play,
    game: game.game,
    result
  };
}

// src/hooks/index.ts
function useGambaPlatformContext() {
  return import_react23.default.useContext(GambaPlatformContext);
}
function useFees() {
  const context = import_react23.default.useContext(GambaPlatformContext);
  const pool = useCurrentPool();
  const creatorFee = context.defaultCreatorFee;
  const jackpotFee = context.defaultJackpotFee;
  return creatorFee + pool.gambaFee + pool.poolFee + jackpotFee;
}
function useCurrentToken() {
  const { token } = import_react23.default.useContext(GambaPlatformContext).selectedPool;
  return useTokenMeta(token);
}
function useTokenBalance(mint) {
  const token = useCurrentToken();
  const userAddress = (0, import_gamba_react_v27.useWalletAddress)();
  const realBalance = (0, import_gamba_react_v27.useBalance)(userAddress, mint ?? token.mint);
  const fake = useFakeToken();
  if (!mint && fake.isActive || mint?.equals(FAKE_TOKEN_MINT)) {
    return {
      ...realBalance,
      balance: fake.balance.balance,
      bonusBalance: 0
    };
  }
  return realBalance;
}
function useUserBalance(mint) {
  return useTokenBalance(mint);
}

// src/makeHeliusTokenFetcher.ts
var import_web35 = require("@solana/web3.js");
function makeHeliusTokenFetcher(heliusApiKey, params = {}) {
  const { dollarBaseWager = 1 } = params;
  return async (tokenMints2) => {
    const response = await fetch("https://mainnet.helius-rpc.com/?api-key=" + heliusApiKey, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        jsonrpc: "2.0",
        id: "my-id",
        method: "getAssetBatch",
        params: { ids: tokenMints2 }
      })
    });
    const { result } = await response.json();
    const tokens = result.filter((x) => !!x).reduce((prev, x) => {
      const info = x?.token_info;
      const usdPrice = info?.price_info?.price_per_token;
      const data = {
        mint: new import_web35.PublicKey(x.id),
        image: x.content?.links?.image,
        symbol: x.content?.metadata.symbol ?? info.symbol,
        decimals: info.decimals,
        name: x.content?.metadata.name ?? info.symbol,
        baseWager: dollarBaseWager / usdPrice * 10 ** info.decimals || 1,
        usdPrice
        // usdPrice: info.price_info?.price_per_token ?? 0,
      };
      return { ...prev, [x.id.toString()]: data };
    }, {});
    return tokens;
  };
}

// src/index.ts
function useWagerInput(initial) {
  const [_wager, setWager] = import_react24.default.useState(initial);
  const context = import_react24.default.useContext(GambaPlatformContext);
  const token = useTokenMeta(context.selectedPool.token);
  return [_wager ?? token.baseWager, setWager];
}
function useTokenList() {
  return import_react24.default.useContext(TokenMetaContext).tokens ?? [];
}
var GambaStandardTokens = {
  fake: {
    mint: new import_web36.PublicKey("FakeCDoCX1NWywV9m63fk7gmV9S4seMoyqzcNYEmRYjy"),
    name: "Fake Money",
    symbol: "FAKE",
    decimals: 9,
    baseWager: 1 * 1e9
  },
  sol: {
    mint: new import_web36.PublicKey("So11111111111111111111111111111111111111112"),
    name: "Solana",
    symbol: "SOL",
    decimals: 9,
    baseWager: 0.01 * 1e9
  },
  usdc: {
    mint: new import_web36.PublicKey("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),
    name: "USDC",
    symbol: "USDC",
    decimals: 6,
    baseWager: 0.5 * 1e6
  },
  guac: {
    mint: new import_web36.PublicKey("AZsHEMXd36Bj1EMNXhowJajpUXzrKcK57wW4ZGXVa7yR"),
    name: "Guacamole",
    symbol: "GUAC",
    decimals: 5,
    baseWager: 1e6 * 1e5
  }
};
// Annotate the CommonJS export names for ESM import in node:
0 && (module.exports = {
  EffectTest,
  FAKE_TOKEN_MINT,
  GambaCanvas,
  GambaPlatformContext,
  GambaPlatformProvider,
  GambaStandardTokens,
  GambaUi,
  GameContext,
  PlayButton,
  TokenMetaContext,
  TokenMetaProvider,
  TokenValue,
  makeHeliusTokenFetcher,
  useCurrentPool,
  useCurrentToken,
  useFakeAccountStore,
  useFakeToken,
  useFees,
  useGambaAudioStore,
  useGambaPlatformContext,
  useGame,
  useNextFakeResult,
  useSound,
  useSoundStore,
  useTokenBalance,
  useTokenList,
  useTokenMeta,
  useUserBalance,
  useWagerInput
});
